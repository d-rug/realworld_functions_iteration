# Iterating with for loops {-}

There are lots of ways to iterate: apply functions, map function, and for loops are among the most popular. We're going to use for loops here because I think is best displays the logic of iteration. So, what we're trying to do is NOT this:

```{r, echo = F, warning = F, message = F}
library(lubridate)
process_patents <- function(filepath){
    df <- read.csv(filepath)
    df$App_Date <- ymd(as.character(df$App_Date))
    df$Issue_Date <- ymd(as.character(df$Issue_Date))
    return(df)
}
```

```{r}
patent77_1 <- process_patents(filepath = "~/Box/d-rug/data/uspto_1977_1.csv")
patent77_2 <- process_patents(filepath = "~/Box/d-rug/data/uspto_1977_2.csv")
patent77_3 <- process_patents(filepath = "~/Box/d-rug/data/uspto_1977_3.csv")
patent77_4 <- process_patents(filepath = "~/Box/d-rug/data/uspto_1977_4.csv")
# And so on...
patents <- rbind(patent77_1, patent77_2, patent77_3, patent77_4)
```

So again, what is it here that changes every time? Only the number. This makes it an easy candidate for looping through, were each loop inputs a new number. Let's first do this with only the year 1977. There are 52 weeks so we want to run the process_patents function on all 52, then bind them together.

The key here is understanding the use of the index, i, and how it relates to the function you want to run. In this case, we want to run through the loop 52 times, each time coutning up from 1 to 52. So here is the basic logic of the loop.

```{r}
for(i in 1:52){
  print(i)
}
```

Now that we got that, we need to understand how to incorporate that number into the filepath, so that the filepath changes each time. This only takes understanding the `paste0()` function in base R, which pastes together strings. For example we could paste together the different parts of the filepath, where different parts are separated by commas.

```{r}
paste0("~/Box/d-rug/data/uspto_1977_", "1", ".csv")
```

We can then insert this logic into our for loop's filepath, but instead of pasting in the number itself, we paste in the value of i, because that value of i will change with every loop. Let's give it a try

```{r, warning=F}
for(i in 1:52){
    patents <- process_patents(paste0("~/Box/d-rug/data/uspto_1977_", i, ".csv"))
}
summary(patents)
```
Something's off here -- we get an output but it is small and when we look at the issue dates we see all the last week of December. So we actually only have the last week worth of data. This is similar to what happened when we didn't return the dataframe in the function -- even though the loop runs through each week, it overwrites that output each time with the following week until the final product is only the last iteration. So one more step helps us get past this, which is to create an empty data frame outside of the loop, then rbind to that empty dataframe over each iteration (binding helps us grow that data frame, rather than overwrite it).

```{r}
patents <- data.frame()
for(i in 1:52){
    df <- process_patents(paste0("~/Box/d-rug/data/uspto_1977_", i, ".csv"))
    patents <- rbind(patents, df)
}
summary(patents)
```

That's more like it! But what about 1978...
